---
title: "Stable Diffusionを使ってみた"
meta_title: "using stable difussion"
description: "this is meta description"
date: 2024-10-06T05:00:00Z
image: "/images/image-placeholder.png"
categories: ["blog"]
author: "takahashi"
tags: ["stable-diffusion"]
draft: false
---

# Stable Difussionを使ってみた

最近、なにかと自分でイラストが描けたらいいなと思うことがありまして、
そこで思いついたのが、AIに書いてもらえばいいじゃないかと。

そこで、筆者が5時間程度勉強しましたので、その情報を共有させてください。

ただし、正確な情報でない可能性があるので、参考適度にしていただければ。

これからもっと画像生成して、使い方をマスターしていきたいと思っていますので、
進捗があれば、また共有させてもらいます。

## そもそもStable Diffusionとは

google aiによる検索結果では、

テキストや画像を入力することで、写真のような画像を生成する生成型人工知能（AI）モデルです。

Stable Diffusionの特徴は次のとおりです。

- オープンソース（無料）で誰でも利用できる
- 他の画像生成AIと比較して、高いクオリティの画像を生成できる
- 学習データの追加や調整が可能
- 運営による急な仕様変更がない
- 拡散技術に基づいており、処理要件が大幅に緩和されている
- わずか5枚の画像を使用するだけで特定のニーズに合わせて微調整できる

Stable Diffusionでは、アマゾンの密林や夕暮れの海辺の風景など、様々なシーンを英語のキーワードで示すだけで、様々な画像を自動で生成することができます。また、モデルを使用して動画やアニメーションを作成することもできます。

Stable Diffusionの画像を商用利用することは、個人情報や誤った情報を広めるなど、人に危害を与えるようなケースを除き、基本的に認められています。

Stable Diffusionをブラウザを通じて手軽に利用するには、Stable Diffusion Web UI（AUTOMATIC1111版・Forge版）があります。プログラミングの知識は不要で、簡単なグラフィカルな操作で画像を生成できます。

とありました。

要するに画像生成を無料で無制限にできるサービスということです。

## 推奨スペック

- OS: Windows（64bit）
- CPU: 最新モデルのCore i5～Core i7、Ryzen 5～7
- GPU: RTX 30シリーズやRTX 40シリーズのVRAMが12GB以上
- メモリ: 16GB～32GB

OSはwindowsが無難だと思います、macでもできなくはないと思いますが。

CPUはそこまで、重要ではないと思います。そこそこで十分です。

大事なのは、GPUです。重要なのは、VRAMで、GPUのメモリのことです。
VRAMにも種類があり、専用VRAMと共有VRAMがありますが、専用VRAMのほうが重要だと思います。
筆者はRTX3070tiを使用していましたが、専用VRAMは８GBでしたが、常にフルで使っていました。

メモリは32GBにしてください。16GBでは絶対に足りません。

## ではインストールしていこう

ネット上にこれは情報が転がっていたので、そこからわかりやすくまとめさせてもらいました。

### インストールするもの

- Python Version 3.10.6

  [installer_link](https://www.python.org/downloads/release/python-3106/)

- Git

  [installer_link](https://git-scm.com/downloads)

- Stable Diffusion

  [github_link](https://github.com/AUTOMATIC1111/stable-diffusion-webui)

### インストール手順

1. まず、Pythonをインストールしましょう。

   注意すべきは最初のインストール画面で
   **Add Python 3.10 to PATH**
   という項目があるので、チェックを忘れずにつけましょう。

   そうしないと、パスが通らなくて、後にエラーになる原因になります。

   それ以外はそのまま流れに沿ってインストールしていってください。

   一応、コマンドプロンプトで

   ```powershell
   python -V
   ```

   を実行して、pythonのバージョンが表示されればOKです。
   逆に、pythonというコマンドは、存在しません。みたいなコメントが表示されたら、
   再インストールしましょう。

2. Gitをインストールしましょう。

   こちらは特に、注意すべきことはありません。

3. ついに、Stable Diffusionをインストールしましょう。

   おまたせしました。ついに、インストールの時が来ました。
   これが少し難しいので、丁寧に。

   まず、Stable Diffusionをクローンします。
   コマンドプロンプトで、インストールしたいフォルダの場所まで移動したら、

   ```powershell
   git clone https://github.com/AUTOMATIC1111/stable-diffusion-webui.git
   ```

   こちらを実行してください。

   正常に終了したら、作成されたフォルダ内にある、

   webui-user.bat

   というファイルを実行します。ルートディレクトリの下のほうにあると思います。
   これは、Stable Diffusionを立ち上げるたびに実行しなければならないので、ショートカットを作成しておけばよいと思います。

   すると、しばらくして、WEBブラウザが立ち上がると思います。これでとりあえず、ひと段落終了です。

## 次はついに、画像生成に挑戦！

さあ、準備も終わったところで、ここから本格的に画像生成を始めましょう。
ここから、ネット上に転がっている情報があいまいになってきます。

これから、画像生成をする際に、必ず覚えてもらいたい順序があります。

1. モデルを用意する。ここでは、CHECKPOINT MERGEというやつ。
2. LORAなどがあれば、それもインストールする。
3. プロンプトを書く。（Negative Promptも含めて）
4. それ以外のメタデータがあれば、それを反映する。

です。何をいっているのかわからないと思うので、順に詳しく説明していきます。

1.  まず、モデルを用意しましょう。

    そもそも、モデルとは何でしょうか。ここでも、Google AIによる検索結果では、

    モデルとは、画像生成AIのStable Diffusionでオリジナルの画像を生成するために学習済みファイルとして使用されるデータセットです。
    モデルを活用することで、プロンプト入力なしでも、モデルに応じた雰囲気やスタイルなどを活用してAI画像を生成することができます。

    とありました。モデルは、全世界でオープンに公開されています。

    ここでは、CivitAIというサイトを使って、モデルを探していきましょう。
    ほかにも、いろいろモデルを公開しているサイトはあります。興味があれば、自分で探してみてください。

    [civitAI_link](https://civitai.com/)

    このサイトについたら、まず、上のタブからModelsを選択し、好きなモデルを探してみましょう。

    好きなモデルが見つかったら、下のほうにスクロールし、Galleryを見てみましょう。
    ここでは、実際にそのモデルを使って、ほかのユーザが描いたイラストが公開されています。

    好きな絵を選びましょう。

    好きな絵を選んだら、右のほうにタブが見えると思います。
    Generation dataというやつです。

    まず、Resources usedというところから、CHECKPOINTというのを探します。
    これが、モデルです。そのリンクを別タブで開き、

    そのタブから、右のタブに、ボタンが複数あると思います。そこからDownloadというのをクリックして、
    ダウンロードしましょう。
    これが結構重いファイルなので、容量には注意しましょう。

    ダウンロードが終わったら、ここからが、注意。
    先ほどクローンしたフォルダ内にそのファイルを配置する必要があります。

    \\stable-diffusion-webui\\models\\Stable-diffusion

    内にモデルを配置してください。

    配置が完了したら、開かれているWEBブラウザで選択します。
    一番上に、ドロップダウンがあると思うので、右の更新ボタンを押したうえで、
    選択してください。
    モデルがフォルダ内に配置されていないと、ここのドロップダウンで表示されないです。

2.  LORAがあれば、それもインストールしましょう

    次は、LORAです。
    これは、

    LoRAとは、LLM（大規模言語モデル）や画像生成AIモデルの追加学習データを指します。LoRAはLow Rank Adaptationの略称で、Stable Diffusionでcheckpointと呼ばれるモデルファイルに対して追加学習を行い、差分を記録したファイルになります。
    画像生成において、元のモデルのパラメータを直接変更するファインチューニングは高スペックマシンと高度な技術を必要とします。代わりにLoRAを導入して、さまざまなパラメータの変更を行うことができます。少ない計算量で元のモデルに修正を加えられるので、比較的低スペック（と言ってもプロユースの）PCでもファインチューニングが可能になりました。
    いわば、元のモデルファイルに対して微調整を行う機能で、描く絵のクオリティを劇的に上げたり、好きな画風や特徴を絵に加えることが可能です。LoRAを活用することで、オリジナリティあふれた高品質作品をスピーディに生み出すことができます。
    AIがただランダムに画像を生成するのではなく、LoRAの設定に基づいて、目指す美しさやスタイルにぴったり合った作品を作り出すことができるということです。

    というものらしいです。よくわからないですが、より高品質な画像を生成したい場合に使用するものという認識でいいと思います。

    さきほど、Resourced usedを見たと思いますが、そこにはLORAが含まれている場合があります。
    それもインストールしましょう。リンクを別タブで開いてください。

    そのタブから、右のタブに、ボタンが複数あると思います。そこからDownloadというのをクリックして、
    ダウンロードしましょう。
    こちらも結構重いファイルになっています。

    ダウンロードが終わったら、同じように、先ほどクローンしたフォルダ内にそのファイルを配置する必要があります。
    今度は、

    \\stable-diffusion-webui\\models\\Stable-diffusion

    内にモデルを配置してください。
    こちらは特に、設定する必要はありません。
    次に書くプロンプトで指定すれば、勝手に参照してくれます。

3.  プロンプトを書きましょう

    Google AIによる検索結果では、プロンプトとは、

    画像生成AIであるStable Diffusionに「描いてほしいイラストの内容」を伝える文章やキーワードです。プロンプトは「呪文」とも呼ばれ、Stable Diffusionを使いこなす上で重要な要素です。
    プロンプトの内容次第で生成される画像が大きく変わるため、明確で具体的なプロンプトを入力することが大切です。プロンプトには、次のような特徴があります。

    - プロンプトは75個の単語で1つのグループとして扱われ、グループ内の1番目の単語が最も影響が強い。
    - プロンプトとネガティブプロンプトの両方の要素を入力することで、画像のクオリティが上がります。ネガティブプロンプトとは、画像を生成する際に除外したい内容のテキストです。

    らしい。呪文とは、物騒ですね。
    それはさておき、同様に、Generation dataには、PromptとNegative Promptが描かれています。
    コピーしたら、開いているWEBブラウザに張り付けましょう。

    また、自分で少し、プロンプトを変えてみるのも面白いと思います。

4.  その他のメタデータを設定しましょう。

    開いているWEBブラウザで対応するメタデータを設定しましょう。
    正直これは、効果を実感できていないので、初期設定でもよい気がします。
    ここら辺は、研究しておきます。

ここまで、できたら、完了です。
設定は完了したので、右のGenerateボタンを押せば、画像生成が開始されます。

ここで一つ画質設定について補足したいのですが、
もちろん画質をあげればあげるほど、生成スピードは落ちてしまいます。

また、あげすぎて、グラフィックカードのメモリ以上に生成する画像の画質を指定すると生成に失敗してしまいます。

筆者はRTX3070tiを使用し、専用メモリ8GB、共有メモリ16GBでしたが、画質設定は
Hires.fixを設定したうえで、縦横864pxぐらいが限界でした。
しかも、生成には１枚に５分から１０分程度かかってしまいます。

Hires.fixとは高解像度の画像を生成してくれる機能で、２倍に高画質化してくれるそうです。

## お疲れさまでした。

いかがでしたでしょうか。

意外と難しいものですね。

しかし、マスターすれば、自分で一からイラストを描かなくても、勝手にAIがイラストを生成してくれるので、
マスターする価値はあると思います。

このBLOGが少しでも参考になればうれしいです。ここまで読んでいただきありがとうございました。
